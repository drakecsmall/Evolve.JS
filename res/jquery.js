(function(a){a.fn.extend({dock_left:function(b){b=a.extend({},b);return this.each(function(){$block=a(this);$parent=$block.parent();$parent.children("div.left_block:last").length?$parent.children("div.left_block:last").after($block):$parent.children("div.top_block:last").length?$parent.children("div.top_block:last").after($block):$parent.prepend($block);$parent.children("div.da_blocks").hide();$block.children("div.name, div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").show();
$margins=a.calc_margins($parent);$block_style=$block.data("style");$block.removeClass().css({top:"",left:"",position:"","margin-bottom":$margins.bottom,width:$min_width,"background-color":$block_style["background-color"]}).data({style:{height:"auto",width:$min_width,"background-color":$block_style["background-color"]}}).addClass("left_block").addClass($block.data("className"));$block.set_block_menu();a(".body").calc_dim();a(".body").reset_dim();$block.unbind("dblclick");$block.draggable("disable");
$block.resizable({helper:"ui-resizable-helper",zIndex:$block.data("zIndex"),handles:"e",grid:$scale,stop:function(){a(this).data("style").width=parseInt(a(this).css("width"))/$scale+a.get_size_ed(a(this).css("width"));$parent=a(this).parent();a(".body").calc_dim();a(".body").reset_dim();$parent.set_menu_position()}});$parent.set_menu_position();return a(this)})},dock_top:function(b){b=a.extend({},b);return this.each(function(){$block=a(this);$parent=$block.parent();$parent.children("div.top_block:last").length?
$parent.children("div.top_block:last").after($block):$parent.prepend($block);$parent.children("div.da_blocks").hide();$block.children("div.name, div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").show();$block_style=$block.data("style");$block.removeClass().css({top:"",left:"",position:"",width:"100%",height:$min_height,"background-color":$block_style["background-color"]}).data({style:{width:"100%",height:$min_height,"background-color":$block_style["background-color"]}}).addClass("top_block").addClass($block.data("className"));
$block.set_block_menu();a(".body").calc_dim();a(".body").reset_dim();$block.unbind("dblclick");$block.draggable("disable");$block.resizable({helper:"ui-resizable-helper",zIndex:$block.data("zIndex"),handles:"s",grid:$scale,stop:function(){a(this).data("style").height=parseInt(a(this).css("height"))/$scale+a.get_size_ed(a(this).css("height"));$parent=a(this).parent();a(".body").calc_dim();a(".body").reset_dim();$parent.set_menu_position()}});return a(this)})},dock_bottom:function(b){b=a.extend({},
b);return this.each(function(){$block=a(this);$parent=$block.parent();$margins=a.calc_margins($parent);$parent.children("div.bottom_block:first").length?$parent.children("div.bottom_block:first").before($block):$parent.append($block);$parent.children("div.da_blocks").hide();$block.children("div.name, div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").show();$block_style=$block.data("style");$block.removeClass().css({top:"",left:"0px",position:"",width:"100%",height:$min_height,
"background-color":$block_style["background-color"]}).data({style:{width:"100%",height:$min_height,"background-color":$block_style["background-color"]}}).addClass("bottom_block").addClass($block.data("className"));$block.css({bottom:$margins.bottom+"px"});$block.set_block_menu();a(".body").calc_dim();a(".body").reset_dim();$block.unbind("dblclick");$block.draggable("disable");$block.resizable({helper:"ui-resizable-helper",zIndex:$block.data("zIndex"),handles:"n",grid:$scale,stop:function(){a(this).data("style").height=
parseInt(a(this).css("height"))/$scale+a.get_size_ed(a(this).css("height"));a(this).css({top:"",left:""});$parent=a(this).parent();a(".body").calc_dim();a(".body").reset_dim();$parent.set_menu_position()}});return a(this)})},dock_right:function(b){b=a.extend({},b);return this.each(function(){$block=a(this);$parent=$block.parent();$parent.children("div.right_block:first").length?$parent.children("div.right_block:first").before($block):$parent.children("div.left_block:last").length?$parent.children("div.left_block:last").after($block):
$parent.children("div.top_block:last").length?$parent.children("div.top_block:last").after($block):$parent.prepend($block);$parent.children("div.da_blocks").hide();$block.children("div.name, div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").show();$margins=a.calc_margins($parent);$block_style=$block.data("style");$block.removeClass().css({top:"",left:"",position:"","margin-bottom":$margins.bottom,width:$min_width,"background-color":$block_style["background-color"]}).data({style:{height:"auto",
width:$min_width,"background-color":$block_style["background-color"]}}).addClass("right_block").addClass($block.data("className"));$block.set_block_menu();a(".body").calc_dim();a(".body").reset_dim();$block.unbind("dblclick");$block.draggable("disable");$block.resizable({helper:"ui-resizable-helper",zIndex:$block.data("zIndex"),handles:"w",grid:$scale,stop:function(){a(this).data("style").width=parseInt(a(this).css("width"))/$scale+a.get_size_ed(a(this).css("width"));$parent=a(this).parent();a(this).css({top:"",
left:""});a(".body").calc_dim();a(".body").reset_dim();$parent.set_menu_position()}});return a(this)})},dock_center:function(b){b=a.extend({},b);return this.each(function(){$block=a(this);$parent=$block.parent();$parent.children("div.right_block:last").length?$parent.children("div.right_block:last").after($block):$parent.children("div.left_block:last").length?$parent.children("div.left_block:last").after($block):$parent.children("div.top_block:last").length?$parent.children("div.top_block:last").after($block):
$parent.prepend($block);$parent.children("div.da_blocks").hide();$block.children("div.name, div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").show();$margins=a.calc_margins($parent);$block_style=$block.data("style");$block.removeClass().css({top:"",left:"",position:"",width:"auto","margin-bottom":$margins.bottom,"background-color":$block_style["background-color"]}).data({style:{width:"auto",height:"auto","background-color":$block_style["background-color"]}}).addClass("center_block").addClass($block.data("className"));
$block.set_block_menu();a(".body").calc_dim();a(".body").reset_dim();$block.unbind("dblclick");$block.draggable("disable");return a(this)})},dock_reattach:function(b){b=a.extend({},b);if(a(this).parent().find("div.new_block").length<=0)return this.each(function(){var b=a(this),d=b.parent();$parent_content=d.children("div.da_blocks");$block_style=b.data("style");b.removeClass().removeData("style").data("style",{"background-color":$block_style["background-color"]}).css({width:"",height:"",margin:"",
"background-color":$block_style["background-color"]}).addClass("new_block");b.children("div.name, div.da_blocks, div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").hide();b.dblclick(function(){a(this).dock_center()});b.children(".uimenu").next().remove();b.children(".uimenu").remove();b.append(a($new_block_menu_template));a(".body").calc_dim();a(".body").reset_dim();b.center({inside:$parent_content});b.draggable("enable");b.data().resizable&&b.resizable("destroy");
d.children("div.da_blocks").show();d.set_menu_position();return a(this)});else alert("\u0417\u0430\u043a\u043e\u043d\u0447\u0438\u0442\u0435 \u0434\u043e\u0431\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0430\u043a\u0442\u0438\u0432\u043d\u043e\u0433\u043e \u0431\u043b\u043e\u043a\u0430.");return this},dock_remove:function(b){b=a.extend({},b);return this.each(function(){var b=a(this),d=b.parent();b.remove();a(".body").calc_dim();a(".body").reset_dim();d.set_menu_position()})}})})(jQuery);
(function(a){a.fn.extend({set_block_menu:function(b){b=a.extend({},b);return this.each(function(){var b=a(this);a(".window");$old_menu=b.children(".uimenu");$old_menu.unbind("click");$old_menu.remove();$new_menu=a($block_menu_template);b.append($new_menu);$parent_block=b.parent();$parent_block.set_menu_position()})},set_menu_position:function(b){b=a.extend({},b);return this.each(function(){var b=a(this);$menu=b.children(".uimenu");$margins=a.calc_margins(b);$menu.show();b.children("div.center_block").length?
$menu.hide():b[0].scrollWidth-$margins.left-$margins.right<=1||b[0].scrollHeight-$margins.top-$margins.bottom<=1?$menu.hide():$menu.css({left:$margins.left+2+"px",top:$margins.top+2+"px"})})},reset_dim:function(b){b=a.extend({},b);return this.each(function(){var b=a(this);b.children("div.name").prependTo(b);$blockMaxHeight=a.maxHeight(b.children("div.left_block, div.right_block, div.center_block"));b.children("div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").each(function(){a(this).data().style&&
a(this).data("style").height?a(this).data("style").height=="auto"?a(this).css({height:""}):a(this).css("height",a.scale_size(a(this).data("style").height,$scale)):a(this).css({height:""});a(this).data().style&&a(this).data("style").width?a(this).data("style").width=="auto"?a(this).css("width",""):a(this).css("width",a.scale_size(a(this).data("style").width,$scale)):a(this).css("width","")});$margins=a.calc_margins(b);$nheight=b.height()-$margins.top-$margins.bottom;$blockMaxHeight>$nheight&&($nheight=
$blockMaxHeight);$rmargins=a.calc_rmargins(b);b.children("div.left_block, div.right_block, div.center_block").each(function(){a(this).data().style&&a(this).data("style").height&&a(this).data("style").height=="auto"&&a(this).height($nheight);a(this).css("margin-bottom",$margins.bottom+"px");a(this).data("style",a.extend(a(this).data().style,{"padding-bottom":$rmargins.bottom+"px","margin-top":$rmargins.top+"px"}))});var d=0,e=0;b.children("div.left_block, div.right_block").each(function(){a(this).hasClass("left_block")?
(a(this).data("style",a.extend(a(this).data().style,{"margin-left":d+"px"})),d+=parseInt(a(this).data("style").width)):a(this).hasClass("right_block")&&(a(this).data("style",a.extend(a(this).data().style,{"margin-right":e+"px"})),e+=parseInt(a(this).data("style").width))});$margins=a.calc_margins(b);var f=b.children("div.center_block");f.length>0&&f.css({"margin-left":$margins.left+"px","margin-right":$margins.right+"px"}).data("style",a.extend(f.data().style,{"margin-left":$margins.left+"px","margin-right":$margins.right+
"px"}));b.children("div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").each(function(){a(this).reset_dim()});$margins=a.calc_margins(b);b.children("div.da_blocks").css({left:$margins.left+"px",right:$margins.right+"px",top:$margins.top+"px",bottom:$margins.bottom+"px"});b.set_menu_position()})},my_clone:function(){var b=a(this),c=b.data(),d=a("<div>");d.attr("class",b.attr("class"));d.attr("style",b.attr("style"));d.data(a.extend({},{style:a.extend({},c.style),name:c.name,
className:c.className}));b=b.children("div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block");b.length>0&&b.each(function(){d.append(a(this).my_clone())});return d},calc_dim:function(){var b=a(this);b.children("div.left_block, div.right_block, div.top_block, div.bottom_block, div.center_block").each(function(){a(this).calc_dim()});b.data("style").height&&b.data("style").height!="auto"?b.css("height",a.scale_size(b.data("style").height,$scale)):b.css("height","");$blockMaxHeight=
a.maxHeight(b.children("div.left_block, div.right_block, div.center_block"));$margins=a.calc_margins(b);$nheight=b.height()-$margins.top-$margins.bottom;if($blockMaxHeight>$nheight)b.data("style").rheight=$blockMaxHeight+$margins.top+$margins.bottom;else{var c=b.data("style");delete c.rheight;b.data("style",c)}}});a.calc_margins=function(b){$margins={left:0,right:0,top:0,bottom:0};b.children("div.top_block").each(function(){$margins.top+=a(this).height()});b.children("div.bottom_block").each(function(){$margins.bottom+=
a(this).height()});b.children("div.left_block").each(function(){$margins.left+=a(this).width()});b.children("div.right_block").each(function(){$margins.right+=a(this).width()});return $margins};a.calc_rmargins=function(b){$margins={left:0,right:0,top:0,bottom:0};b.children("div.top_block").each(function(){$margins.top+=parseInt(a(this).data("style").height)});b.children("div.bottom_block").each(function(){$margins.bottom+=parseInt(a(this).data("style").height)});b.children("div.left_block").each(function(){$margins.left+=
parseInt(a(this).data("style").width)});b.children("div.right_block").each(function(){$margins.right+=parseInt(a(this).data("style").width)});return $margins};a.add_new_block=function(b,c){a.trim(b.find("input[name='name']").val())==""?a.alert("\u0423\u043a\u0430\u0436\u0438\u0442\u0435 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0431\u043b\u043e\u043a\u0430."):(c.children("div.da_blocks").show(),$new_block=a($new_block_template),$new_block.css("background-color","#"+b.find("input[name='color']").val()),
$new_block.data("id",a.rnd()),$name=b.find("input[name='name']").val(),$name=a.trim($name),$name=$name.replace(/\s/,""),$new_block.children(".name").text($name),$new_block.data("name",$name),$new_block.data("className",a.trim(b.find("input[name='class']").val())),$new_block.data({style:{"background-color":"#"+b.find("input[name='color']").val()}}),$new_block.attr("title",$name),b.dialog("close"),c.append($new_block),$new_block.append(a($new_block_menu_template)),$new_block.children(".uimenu").data({"background-color":$bg_color}),
$parent_content=c.children("div.da_blocks"),$new_block.children(".da_blocks").hide(),$new_block.draggable({scope:c.data("id"),containment:$parent_content,cursor:"move",scroll:false,start:function(){}}),$new_block.data("zIndex",$new_block.parent().data("zIndex")+1),$new_block.dblclick(function(){a(this).dock_center()}),$new_block.center({inside:$parent_content}))};a.block_params=function(b,c){var d=b.find("input[name='width']").val()+b.find("input[name='width']").next().val(),e=b.find("input[name='height']").val()+
b.find("input[name='height']").next().val();c.data().className&&c.removeClass(c.data("className"));c.data({style:a.extend(c.data().style,{width:d,height:e}),className:b.find("input[name='class']").val(),name:b.find("input[name='name']").val()});a(".name",c).text(b.find("input[name='name']").val());c.addClass(c.data("className"));$scale>1&&(a.scale_size(d,$scale),a.scale_size(e,$scale));a(".body").calc_dim();a(".body").reset_dim()};a.alert=function(b){$div=a('<div title="\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435">'+
b+"</div>");$div.dialog({modal:true,resizable:false,buttons:{Ok:function(){a(this).dialog("close");$div.remove()}}})};a.rnd=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};a.maxHeight=function(b){var c=0;b.each(function(){a(this).height();var b=0,b=a(this).data("style").rheight||a(this).data("style").height;if(b!="auto"&&(b=parseInt(b))&&b>c)c=b});return c};a.get_size_ed=function(a){a+="";if(a=="auto")return"";else if(a.search(/%$/i)!=-1)return"%";else if(a.search(/px$/i)==
-1&&a.search(/em$/i)!=-1)return"em";return"px"};a.scale_size=function(b,c){return a.get_size_ed(b)=="px"||a.get_size_ed(b)=="em"?parseInt(b)*c+a.get_size_ed(b):b};a.data2style=function(b){var c="",d;for(d in b)c+=d+": "+b[d]+"; ";return a.trim(c)};a.rgb2hex=function(a){a=a.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/);return"#"+("0"+parseInt(a[1],10).toString(16)).slice(-2)+("0"+parseInt(a[2],10).toString(16)).slice(-2)+("0"+parseInt(a[3],10).toString(16)).slice(-2)}})(jQuery);
$.widget("ui.nestedmenu",{_init:function(){var a=this;this.active=this.element;this.element.find("ul").hide().prev("a").prepend('<span class="ui-icon ui-icon-carat-1-e"></span>');this.element.find("ul").andSelf().menu({input:$(),select:this.options.select,focus:function(b,c){a.active=c.item.parent();a.activeItem=c.item;c.item.parent().find("ul").hide();var d=$(">ul",c.item);d.length&&/^mouse/.test(b.originalEvent.type)&&a._open(d)}})},_open:function(a){a.show().css({top:0,left:0}).position({my:"left top",
at:"right top",of:this.activeItem})},up:function(){this.active=this.active.menu("blur").hide().parent().parent();this.activeItem=this.active.data("menu").active},down:function(a){var b=$(">ul",this.activeItem);this._open(b,this.activeItem);b.menu("activate",a,b.children(":first"))},show:function(){this.active=this.element;this.element.show()},hide:function(){this.element.find("ul").andSelf().menu("blur").hide()}});